services:
  conduwuit:
    image: forgejo.ellis.link/continuwuation/continuwuity:latest
    container_name: conduwuit
    environment:
      CONDUWUIT_SERVER_NAME: "matrix.local"
      CONDUWUIT_DATABASE_BACKEND: "rocksdb"
      CONDUWUIT_DATABASE_PATH: "/var/lib/conduwuit"
      CONDUWUIT_ADDRESS: "0.0.0.0"
      CONDUWUIT_PORT: "6167"
      CONDUWUIT_ALLOW_REGISTRATION: "false"
      CONDUWUIT_ALLOW_FEDERATION: "false"
    volumes:
      - conduwuit-data:/var/lib/conduwuit
    ports:
      - "6167:6167"
    deploy:
      resources:
        limits:
          memory: 600M

  swarms-agent:
    image: ghcr.io/zhengui666/imitatort-stateless-agent:${AGENT_TAG:-dev}
    container_name: swarms-agent
    depends_on:
      - conduwuit
    env_file:
      - .env
    environment:
      MATRIX_HOMESERVER: "http://conduwuit:6167"
    deploy:
      resources:
        limits:
          memory: 256M

volumes:
  conduwuit-data:
